#!/bin/bash

# parameter 1: work directory
# parameter 2: path to cdc test binary
# parameter 3: log suffix
# parameter 4: PD address

set -ex

workdir=$1
binary=$2
log_suffix=$3
pd_addr=$4
pwd=$pwd

if [[ ! -z $pd_addr ]]; then
    pd_addr="--pd ${pd_addr}"
fi

echo "[$(date)] <<<<<< START cdc server in $TEST_NAME case >>>>>>"
cd $workdir
$binary -test.coverprofile="$OUT_DIR/cov.$TEST_NAME$log_suffix.out" server --log-file $workdir/cdc$log_suffix.log $pd_addr --log-level debug >> $workdir/stdout$log_suffix.log 2>&1 &
cd $pwd
set +x
